---
layout:     post
title:      "[Draft] ansible 快速入门"
subtitle:   "写给懒人的 ansible 入门指南"
date:       2021-05-28 16:41:00
author:     "kgzhang"
catalog: false
header-style: text
tags:
  - ansible
---

[自用的 ansible-playbook](https://github.com/kougazhang/ansible)

#### 预期读者画像
+ 对 Ansible 所知甚少；
+ 熟悉 Python, 如 Jinja；
+ 熟悉 Linux, 如 ssh;
+ 有在多个机器上部署程序的需求，希望使用 Ansible 实现自动化，但是厌恶文档的长篇大论；

#### 操作环境
本文方法在如下环境中测试通过：
+ 本地系统：macOS High Sierra
+ 目标机器系统：Centos 7
+ Python 3.7.3
+ ansible 2.5.4

#### Ansible 是什么？

Ansible 是一个能够批量部署程序的工具。

Ansible 不需要在目标机器上安装客户端，它通过 SSH 把指令和要部署的程序发送到目标机器上，实现远程操作。

为了让 Ansible 知道你的程序要部署到哪些机器上？你需要编辑名为 hosts 的配置文件。

为了让 Ansible 知道你想在目标机器上执行哪些操作？你需要编辑一个 yaml 文件来声明这些操作。

在 hosts 和 yaml 文件都编辑正确的情况下，你只需要执行一条命令就能实现批量部署程序。

整体逻辑，见下面的示意图：

![ansible-01](/img/in-post/post-ansible-01.png)

## Ansile 安装

## Ansible 配置

**查看版本及配置**

`ansible --version` 命令，可以：
+ 查看 ansible 版本
+ 查看 ansible 配置文件 `.ansible.cfg` 的路径
+ ansible 可执行文件的路径
+ ansible 使用的 Python 版本
![ansible-01](/img/in-post/ansible-01.png)

**ansible 配置文件: .ansible.cfg**
```
[defaults]
# hosts 文件路径
inventory=/Users/yutou/.ansible/hosts
transport=upssh
// 开启的线程数
forks = 10
```

**配置机器密钥**

## 编辑 hosts 
```
# 集群名称
[flink]
# ip 地址
192.168.33.10
```

## 编辑 yaml
```
# hosts 是要执行命令的集群
- hosts: flink
# remote_user 是以 root 用户登录远程机器
  remote_user: root
# vars 是定义一些变量。这些变量可以在 tasks 中使用。
  vars:
     src: /Users/yutou/upai/flink
     dest: /home/flink
# tasks 是在远程机器上具体的执行动作。
  tasks:
      # 该动作的名称
      - name: install java
      # 该动作的具体内容
      command: "echo"
```

ansible 支持的内置命令：
+ copy
+ command
+ ...

## 执行命令
```
ansible-playbook nsq.yml
```
成功输出时的样例：
![nsq-02](/img/in-post/ansible-02.png)