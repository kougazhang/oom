---
layout:     post
title:      "redis"
subtitle:   ""
date:       2021-07-01 21:27:00
author:     "kgzhang"
catalog: false
header-style: text
tags:
  - redis
---
## redis 常用命令
+ 后台启动：`redis-server --daemonize yes`

## redis 作为消息队列
+ https://mp.weixin.qq.com/s/mAVkTWs13d_nAWRA2TNE9w

## 使用 Lua 脚本
+ `KEYS` 是传给 lua 脚本的参数列表；
+ `1`，最后的 1 代表参数列表的长度
+ 在 lua 脚本中使用 `redis.call` 或 `redis.pcall` 执行 redis 命令。

### 单行 lua 语句
```shell
# "a" 是传递给 lua 脚本的参数
redis-cli eval "return redis.call('get', KEYS[1])" 1 "a"
```

### 执行 lua 脚本
如 [sscan.lua](https://gist.github.com/kougazhang/3964a163a649da7f8aa770eae0971c6d)
```shell
redis-cli --eval sscan.lua 2 "jd" 10
```

### 调试 lua 脚本
```shell 
# 加上参数 --ldb 可以开启 debug 模式
redis-cli --ldb --eval sscan.lua 2 "jd" 10 
```
然后会进入类似于 gdb 的交互式状态，输入 `s` 进行下一步。

### lua 脚本返回值
+ 当查询为空时，返回 lua 中的 nil。
+ 如 sscan 命令时，会返回一个嵌套数组，第一个元素是个数（string 形式），第二个元素是查到的真正的值。